<!DOCTYPE html>
<html lang="no">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Arena Survivor - 1st Person</title>
    <style>
        body { margin: 0; background: #000; overflow: hidden; font-family: sans-serif; }
        canvas { display: block; width: 100vw; height: 100vh; image-rendering: pixelated; }
        
        #hud {
            position: absolute; bottom: 30px; left: 30px;
            color: #ff4444; text-shadow: 2px 2px #000;
            font-weight: bold; font-size: 24px;
        }

        #crosshair {
            position: absolute; top: 50%; left: 50%;
            width: 20px; height: 20px;
            border: 2px solid rgba(255,255,255,0.5);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            pointer-events: none;
        }

        .controls-info {
            position: absolute; top: 20px; right: 20px;
            color: rgba(255,255,255,0.7); font-size: 14px;
            background: rgba(0,0,0,0.5); padding: 10px; border-radius: 5px;
        }
    </style>
</head>
<body>

    <div id="crosshair"></div>
    <div id="hud">HP: 100 | AMMO: 30</div>
    <div class="controls-info"><b>W / S</b>: Frem / Tilbake<br><b>A / D</b>: Drei kamera</div>
    <canvas id="game"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

// Render-oppløsning (lavere = mer retro og raskere)
canvas.width = 640;
canvas.height = 360;

// ARENA MAP (1-4 er forskjellige veggfarger, 0 er åpent)
const mapSize = 12;
const map = [
    1,1,1,1,1,1,1,1,1,1,1,1,
    1,0,0,0,0,0,0,0,0,0,0,1,
    1,0,2,0,0,3,3,0,0,4,0,1,
    1,0,2,0,0,0,0,0,0,4,0,1,
    1,0,0,0,0,0,0,0,0,0,0,1,
    1,0,0,0,1,1,1,1,0,0,0,1,
    1,0,0,0,1,0,0,1,0,0,0,1,
    1,0,3,0,0,0,0,0,0,2,0,1,
    1,0,3,0,0,0,0,0,0,2,0,1,
    1,0,0,0,0,4,4,0,0,0,0,1,
    1,0,0,0,0,0,0,0,0,0,0,1,
    1,1,1,1,1,1,1,1,1,1,1,1
];

// Spiller-posisjon og retning
let posX = 2, posY = 2;
let dirX = -1, dirY = 0;
let planeX = 0, planeY = 0.66; // Kamera-vidvinkel

const keys = {};
document.onkeydown = (e) => keys[e.code] = true;
document.onkeyup = (e) => keys[e.code] = false;

function update() {
    const moveSpeed = 0.06;
    const rotSpeed = 0.04;

    // Frem og tilbake (W / S)
    if (keys['KeyW']) {
        if (map[Math.floor(posX + dirX * moveSpeed) + Math.floor(posY) * mapSize] == 0) posX += dirX * moveSpeed;
        if (map[Math.floor(posX) + Math.floor(posY + dirY * moveSpeed) * mapSize] == 0) posY += dirY * moveSpeed;
    }
    if (keys['KeyS']) {
        if (map[Math.floor(posX - dirX * moveSpeed) + Math.floor(posY) * mapSize] == 0) posX -= dirX * moveSpeed;
        if (map[Math.floor(posX) + Math.floor(posY - dirY * moveSpeed) * mapSize] == 0) posY -= dirY * moveSpeed;
    }

    // Rotere kamera (A / D)
    if (keys['KeyD']) {
        let oldDirX = dirX;
        dirX = dirX * Math.cos(-rotSpeed) - dirY * Math.sin(-rotSpeed);
        dirY = oldDirX * Math.sin(-rotSpeed) + dirY * Math.cos(-rotSpeed);
        let oldPlaneX = planeX;
        planeX = planeX * Math.cos(-rotSpeed) - planeY * Math.sin(-rotSpeed);
        planeY = oldPlaneX * Math.sin(-rotSpeed) + planeY * Math.cos(-rotSpeed);
    }
    if (keys['KeyA']) {
        let oldDirX = dirX;
        dirX = dirX * Math.cos(rotSpeed) - dirY * Math.sin(rotSpeed);
        dirY = oldDirX * Math.sin(rotSpeed) + dirY * Math.cos(rotSpeed);
        let oldPlaneX = planeX;
        planeX = planeX * Math.cos(rotSpeed) - planeY * Math.sin(rotSpeed);
        planeY = oldPlaneX * Math.sin(rotSpeed) + planeY * Math.cos(rotSpeed);
    }
}

function draw() {
    // Bakgrunn (Tak og Gulv)
    ctx.fillStyle = "#111"; // Tak
    ctx.fillRect(0, 0, canvas.width, canvas.height / 2);
    ctx.fillStyle = "#222"; // Gulv
    ctx.fillRect(0, canvas.height / 2, canvas.width, canvas.height / 2);

    // Raycasting motor
    for (let x = 0; x < canvas.width; x++) {
        let cameraX = 2 * x / canvas.width - 1;
        let rayDirX = dirX + planeX * cameraX;
        let rayDirY = dirY + planeY * cameraX;

        let mapX = Math.floor(posX);
        let mapY = Math.floor(posY);

        let deltaDistX = Math.abs(1 / rayDirX);
        let deltaDistY = Math.abs(1 / rayDirY);
        
        let stepX, stepY, sideDistX, sideDistY;
        let hit = 0, side = 0, wallType = 0;

        if (rayDirX < 0) { stepX = -1; sideDistX = (posX - mapX) * deltaDistX; }
        else { stepX = 1; sideDistX = (mapX + 1.0 - posX) * deltaDistX; }
        
        if (rayDirY < 0) { stepY = -1; sideDistY = (posY - mapY) * deltaDistY; }
        else { stepY = 1; sideDistY = (mapY + 1.0 - posY) * deltaDistY; }

        while (hit == 0) {
            if (sideDistX < sideDistY) {
                sideDistX += deltaDistX;
                mapX += stepX;
                side = 0;
            } else {
                sideDistY += deltaDistY;
                mapY += stepY;
                side = 1;
            }
            if (map[mapX + mapY * mapSize] > 0) {
                hit = 1;
                wallType = map[mapX + mapY * mapSize];
            }
        }

        let perpWallDist = (side == 0) ? (sideDistX - deltaDistX) : (sideDistY - deltaDistY);
        let lineHeight = Math.floor(canvas.height / perpWallDist);

        // Finn farge basert på veggtype i map-arrayen
        let color;
        switch(wallType) {
            case 1: color = side == 0 ? '#555' : '#333'; break; // Grå
            case 2: color = side == 0 ? '#a33' : '#722'; break; // Rød
            case 3: color = side == 0 ? '#3a3' : '#272'; break; // Grønn
            case 4: color = side == 0 ? '#33a' : '#227'; break; // Blå
        }

        ctx.fillStyle = color;
        ctx.fillRect(x, -lineHeight / 2 + canvas.height / 2, 1, lineHeight);
    }
    
    drawWeapon();
}

function drawWeapon() {
    const time = Date.now() * 0.004;
    const wobble = Math.sin(time) * 4;
    const centerX = canvas.width / 2;
    const bottomY = canvas.height;

    ctx.save();
    ctx.translate(centerX + 80, bottomY - 100 + wobble);
    
    // Tegner en futuristisk børse
    ctx.fillStyle = "#111";
    ctx.fillRect(0, 0, 50, 120); // Håndtak/Kropp
    ctx.fillStyle = "#222";
    ctx.fillRect(-10, -80, 40, 100); // Løpet
    ctx.fillStyle = "#00ff00";
    ctx.fillRect(-2, -70, 4, 40); // Lysende detalj
    
    ctx.restore();
}

function loop() {
    update();
    draw();
    requestAnimationFrame(loop);
}

loop();
</script>
</body>
</html>
